<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Kiosco â€“ Sistema de GestiÃ³n</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{
  --bg:#f4f6f8;--card:#fff;--text:#111;
  --primary:#2563eb;--danger:#dc2626;--ok:#16a34a;
}
body.dark{--bg:#0f172a;--card:#1e293b;--text:#e5e7eb}
*{box-sizing:border-box;font-family:Arial}
body{margin:0;background:var(--bg);color:var(--text)}
.hidden{display:none}
button{cursor:pointer}

/* LOGIN */
#login{height:100vh;display:flex;justify-content:center;align-items:center}
.box{background:var(--card);padding:25px;border-radius:8px;width:320px}
.box input,textarea{width:100%;padding:8px;margin:6px 0}

/* LAYOUT */
#app{display:flex;height:100vh}
aside{width:240px;background:#111827;color:white;padding:15px}
aside button{width:100%;margin:5px 0;padding:8px;background:#1f2937;border:none;color:white}
main{flex:1;padding:15px;overflow:auto}
.card{background:var(--card);padding:15px;border-radius:8px;margin-bottom:12px}
table{width:100%;border-collapse:collapse}
td,th{padding:6px;border-bottom:1px solid #ccc}
.bad{color:var(--danger);font-weight:bold}
.good{color:var(--ok);font-weight:bold}
header{display:flex;justify-content:space-between;align-items:center}
</style>
</head>

<body>

<div id="login">
  <div class="box">
    <h2>Ingreso</h2>
    <input id="u" placeholder="Usuario">
    <input id="p" type="password" placeholder="ContraseÃ±a">
    <button onclick="login()">Entrar</button>
  </div>
</div>

<div id="app" class="hidden">
  <aside>
    <h3>KIOSCO</h3>
    <button onclick="view('ventas')">Ventas</button>
    <button onclick="view('clientes')">Clientes</button>
    <button onclick="view('stock')">Stock</button>
    <button onclick="view('caja')">Caja</button>
    <button onclick="view('facturacion')">FacturaciÃ³n</button>
    <button onclick="view('empleados')">Empleados</button>
    <button onclick="toggleDark()">ðŸŒ™ Modo oscuro</button>
    <button onclick="logout()">Salir</button>
  </aside>

  <main>
    <header>
      <h2 id="title"></h2>
      <div id="fecha"></div>
    </header>
    <div id="content"></div>
  </main>
</div>

<script>
/* ===== AUTH ===== */
let session=JSON.parse(localStorage.getItem("session"))
function login(){
  if(u.value==="admin"&&p.value==="1234"){
    session={user:"admin",role:"owner"}
  }else if(u.value==="empleado"&&p.value==="1234"){
    session={user:"empleado",role:"staff"}
  }else return alert("Credenciales incorrectas")
  localStorage.setItem("session",JSON.stringify(session))
  location.reload()
}
function logout(){localStorage.clear();location.reload()}
if(session){loginDiv.style.display="none";app.classList.remove("hidden")}

/* ===== DATA ===== */
let db=JSON.parse(localStorage.getItem("db"))||{
  ventas:[],clientes:[],stock:[],
  caja:{abierta:false,inicio:0,registros:[]},
  empleados:[]
}
function save(){localStorage.setItem("db",JSON.stringify(db))}

/* ===== NAV ===== */
function view(v){
  title.innerText=v.toUpperCase()
  if(v==="ventas") ventas()
  if(v==="clientes") clientes()
  if(v==="stock") stock()
  if(v==="caja") caja()
  if(v==="facturacion") facturacion()
  if(v==="empleados") empleados()
}
setInterval(()=>fecha.innerText=new Date().toLocaleString(),1000)

/* ===== VENTAS ===== */
function ventas(){
content.innerHTML=`
<div class="card">
<input id="vp" placeholder="Producto">
<input id="vt" type="number" placeholder="Total">
<button onclick="addVenta()">Registrar venta</button>
</div>
<ul>${db.ventas.map(v=>`<li>${v.p} $${v.t}</li>`).join("")}</ul>`
}
function addVenta(){
  db.ventas.push({p:vp.value,t:+vt.value,fecha:new Date()})
  db.caja.registros.push({tipo:"venta",monto:+vt.value})
  save();ventas()
}

/* ===== CLIENTES ===== */
function clientes(){
content.innerHTML=`
<div class="card">
<input id="cn" placeholder="Nombre">
<input id="cd" type="number" placeholder="Deuda">
<button onclick="db.clientes.push({n:cn.value,d:+cd.value});save();clientes()">Agregar</button>
</div>
<ul>${db.clientes.map(c=>`<li>${c.n} <span class="${c.d>0?'bad':'good'}">$${c.d}</span></li>`).join("")}</ul>`
}

/* ===== STOCK ===== */
function stock(){
content.innerHTML=`
<div class="card">
<input id="sn" placeholder="Producto">
<input id="sc" type="number" placeholder="Cantidad">
<button onclick="db.stock.push({n:sn.value,c:+sc.value});save();stock()">Agregar</button>
</div>
<ul>${db.stock.map(s=>`<li>${s.n} (${s.c})</li>`).join("")}</ul>`
}

/* ===== CAJA (PROTEGIDA) ===== */
function caja(){
if(session.role!=="owner") return content.innerHTML="<p>Acceso restringido</p>"
let total=db.caja.registros.reduce((a,r)=>a+r.monto,0)
content.innerHTML=`
<div class="card">
<p>Estado: ${db.caja.abierta?"Abierta":"Cerrada"}</p>
<input id="ci" type="number" placeholder="Monto inicial">
<button onclick="db.caja={abierta:true,inicio:+ci.value,registros:[]};save();caja()">Abrir caja</button>
<button onclick="db.caja.abierta=false;save();caja()">Cerrar caja</button>
<p>Total en caja: <b>$${db.caja.inicio+total}</b></p>
</div>`
}

/* ===== FACTURACIÃ“N (LOGIN DUEÃ‘O) ===== */
function facturacion(){
if(session.role!=="owner") return content.innerHTML="<p>Acceso restringido</p>"
let total=db.ventas.reduce((a,v)=>a+v.t,0)
content.innerHTML=`
<div class="card">
<h3>FacturaciÃ³n</h3>
<p>Total vendido: <b>$${total}</b></p>
<p>Ventas: ${db.ventas.length}</p>
</div>`
}

/* ===== EMPLEADOS (SOLO DUEÃ‘O) ===== */
function empleados(){
if(session.role!=="owner") return content.innerHTML="<p>Acceso restringido</p>"
content.innerHTML=`
<div class="card">
<input id="en" placeholder="Empleado">
<input id="ep" type="number" placeholder="Pago diario">
<button onclick="db.empleados.push({n:en.value,p:+ep.value});save();empleados()">Agregar</button>
</div>
<ul>${db.empleados.map(e=>`<li>${e.n} â€“ $${e.p}/dÃ­a</li>`).join("")}</ul>`
}

/* ===== EXTRAS ===== */
function toggleDark(){document.body.classList.toggle("dark")}
</script>
</body>
</html>
